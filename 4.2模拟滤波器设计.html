<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>信号分析与处理 - 模拟滤波器的设计</title>
    <style>
        body {
            font-family: 'Microsoft YaHei', Arial, sans-serif;
            line-height: 1.6;
            margin: 0;
            padding: 20px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
        }
        
        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: white;
            border-radius: 15px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
            padding: 30px;
        }
        
        h1 {
            color: #2c3e50;
            text-align: center;
            border-bottom: 3px solid #3498db;
            padding-bottom: 10px;
            margin-bottom: 30px;
        }
        
        h2 {
            color: #34495e;
            border-left: 4px solid #3498db;
            padding-left: 15px;
            margin-top: 30px;
        }
        
        h3 {
            color: #2980b9;
            margin-top: 25px;
        }
        
        .knowledge-point {
            background: #f8f9fa;
            border: 1px solid #e9ecef;
            border-radius: 8px;
            padding: 20px;
            margin: 15px 0;
        }
        
        .formula {
            background: #fff3cd;
            border: 1px solid #ffeaa7;
            border-radius: 5px;
            padding: 15px;
            margin: 15px 0;
            text-align: center;
            font-family: 'Times New Roman', serif;
            font-size: 18px;
        }
        
        .important {
            background: #ffeaa7;
            border: 2px solid #fdcb6e;
            border-radius: 8px;
            padding: 15px;
            margin: 15px 0;
        }
        
        .example {
            background: #d1ecf1;
            border: 1px solid #bee5eb;
            border-radius: 5px;
            padding: 15px;
            margin: 10px 0;
        }
        
        .plot-container {
            background: white;
            border: 2px solid #ddd;
            border-radius: 8px;
            padding: 20px;
            margin: 20px 0;
            text-align: center;
        }
        
        canvas {
            border: 1px solid #ccc;
            margin: 10px;
        }
        
        .controls {
            margin: 15px 0;
            text-align: center;
        }
        
        .controls input, .controls select {
            margin: 5px;
            padding: 5px 10px;
            border: 1px solid #ddd;
            border-radius: 4px;
        }
        
        .controls button {
            background: #3498db;
            color: white;
            border: none;
            padding: 8px 15px;
            border-radius: 4px;
            cursor: pointer;
            margin: 5px;
        }
        
        .controls button:hover {
            background: #2980b9;
        }
        
        .exercise {
            background: #e8f5e8;
            border: 1px solid #c3e6c3;
            border-radius: 8px;
            padding: 20px;
            margin: 20px 0;
        }
        
        .exercise h4 {
            color: #2e7d2e;
            margin-top: 0;
        }
        
        .answer {
            background: #f0f0f0;
            border-radius: 5px;
            padding: 10px;
            margin-top: 10px;
            display: none;
        }
        
        .show-answer {
            background: #28a745;
            color: white;
            border: none;
            padding: 5px 15px;
            border-radius: 4px;
            cursor: pointer;
            margin-top: 10px;
        }
        
        .show-answer:hover {
            background: #218838;
        }
        
        table {
            width: 100%;
            border-collapse: collapse;
            margin: 15px 0;
        }
        
        th, td {
            border: 1px solid #ddd;
            padding: 8px;
            text-align: center;
        }
        
        th {
            background: #f2f2f2;
        }
        
        .highlight {
            background: #ffeb3b;
            padding: 2px 5px;
            border-radius: 3px;
        }
        
        .butterworth-box {
            background: #e8f5e8;
            border: 2px solid #4caf50;
            border-radius: 8px;
            padding: 15px;
            margin: 15px 0;
        }
        
        .chebyshev-box {
            background: #fff3e0;
            border: 2px solid #ff9800;
            border-radius: 8px;
            padding: 15px;
            margin: 15px 0;
        }
        
        .comparison-grid {
            display: grid;
            grid-template-columns: 1fr 1fr 1fr;
            gap: 20px;
            margin: 20px 0;
        }
        
        .comparison-item {
            background: #f8f9fa;
            border: 1px solid #dee2e6;
            border-radius: 8px;
            padding: 20px;
            text-align: center;
        }
        
        .design-steps {
            background: #f0f8ff;
            border: 1px solid #87ceeb;
            border-radius: 8px;
            padding: 15px;
            margin: 15px 0;
        }
        
        .design-steps ol {
            margin: 0;
            padding-left: 20px;
        }
        
        .transformation-demo {
            display: flex;
            justify-content: space-around;
            margin: 20px 0;
        }
        
        .transformation-part {
            text-align: center;
            flex: 1;
            margin: 0 10px;
        }
        
        .pole-zero-plot {
            background: #fafafa;
            border: 1px solid #ddd;
            border-radius: 8px;
            padding: 15px;
            margin: 15px 0;
            text-align: center;
        }
        
        .characteristic-table {
            background: #f5f5f5;
            border: 1px solid #ddd;
            border-radius: 8px;
            padding: 15px;
            margin: 15px 0;
        }
        
        .filter-property {
            background: #e3f2fd;
            border: 1px solid #2196f3;
            border-radius: 8px;
            padding: 15px;
            margin: 15px 0;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>信号分析与处理 - 模拟滤波器的设计</h1>
        
        <div class="important">
            <h3>🎯 本节核心内容</h3>
            <p>学习三种经典模拟滤波器的设计方法：</p>
            <ul>
                <li><strong>巴特沃思滤波器</strong>：最大平坦幅度特性</li>
                <li><strong>切比雪夫滤波器</strong>：等纹波特性，更陡峭的过渡带</li>
                <li><strong>频率变换</strong>：从低通原型到其他类型的系统化方法</li>
            </ul>
        </div>
        
        <h2>1. 巴特沃思滤波器设计</h2>
        
        <div class="butterworth-box">
            <h3>🟢 巴特沃思滤波器特性</h3>
            <p>巴特沃思滤波器又称<strong>最大平坦滤波器</strong>，具有以下特点：</p>
            <ul>
                <li><strong>通带内最大平坦</strong>：幅度响应在通带内尽可能平坦</li>
                <li><strong>单调下降</strong>：从通带到阻带单调递减，无纹波</li>
                <li><strong>3dB截止频率</strong>：在截止频率处幅度下降3dB</li>
                <li><strong>简单设计</strong>：设计公式简单，易于实现</li>
            </ul>
        </div>
        
        <div class="knowledge-point">
            <h3>巴特沃思低通滤波器</h3>
            
            <h4>幅度平方响应</h4>
            <div class="formula">
                |H(jω)|² = 1/(1 + (ω/ωc)^(2n))
            </div>
            
            <h4>传递函数</h4>
            <div class="formula">
                H(s) = ωc^n / ∏(k=1 to n)(s - sk)
            </div>
            
            <h4>极点分布</h4>
            <p>极点均匀分布在以ωc为半径的左半圆上：</p>
            <div class="formula">
                sk = ωc · e^(j(2k+n-1)π/(2n)), k = 1, 2, ..., n
            </div>
            
            <div class="example">
                <h4>巴特沃思滤波器的关键特点</h4>
                <ul>
                    <li><strong>阶数n</strong>：决定滤波器的陡峭程度</li>
                    <li><strong>截止频率ωc</strong>：3dB下降点</li>
                    <li><strong>极点特性</strong>：均在左半平面，保证稳定性</li>
                    <li><strong>群延迟</strong>：在通带内变化相对平缓</li>
                </ul>
            </div>
        </div>
        
        <div class="design-steps">
            <h3>🔧 巴特沃思滤波器设计步骤</h3>
            <ol>
                <li><strong>确定技术指标</strong>：通带截止频率ωp、阻带截止频率ωs、通带衰减Ap、阻带衰减As</li>
                <li><strong>计算滤波器阶数</strong>：n ≥ log((10^(As/10) - 1)/(10^(Ap/10) - 1)) / (2log(ωs/ωp))</li>
                <li><strong>确定截止频率</strong>：根据通带或阻带要求选择ωc</li>
                <li><strong>计算极点</strong>：使用极点分布公式</li>
                <li><strong>构造传递函数</strong>：H(s) = ωc^n / ∏(s - sk)</li>
            </ol>
        </div>
        
        <div class="plot-container">
            <h3>巴特沃思滤波器特性演示</h3>
            <canvas id="butterworthDemo" width="800" height="400"></canvas>
            <div class="controls">
                <label>滤波器阶数：</label>
                <input type="range" id="butterworthOrder" min="1" max="8" step="1" value="4">
                <span id="butterworthOrderValue">4</span>
                <label>截止频率：</label>
                <input type="range" id="butterworthCutoff" min="0.5" max="5" step="0.1" value="2">
                <span id="butterworthCutoffValue">2.0</span> Hz
                <button onclick="updateButterworthDemo()">更新特性</button>
            </div>
        </div>
        
        <div class="pole-zero-plot">
            <h3>巴特沃思滤波器极点分布</h3>
            <canvas id="butterworthPoles" width="400" height="400"></canvas>
            <p>极点均匀分布在左半圆上，与实轴成等角度</p>
        </div>
        
        <h2>2. 切比雪夫滤波器设计</h2>
        
        <div class="chebyshev-box">
            <h3>🟡 切比雪夫滤波器特性</h3>
            <p>切比雪夫滤波器分为两类，具有<strong>等纹波特性</strong>：</p>
            <ul>
                <li><strong>第一类切比雪夫</strong>：通带等纹波，阻带单调</li>
                <li><strong>第二类切比雪夫</strong>：阻带等纹波，通带单调</li>
                <li><strong>更陡峭的过渡带</strong>：相同阶数下过渡带更窄</li>
                <li><strong>设计折衷</strong>：纹波换取更好的频率选择性</li>
            </ul>
        </div>
        
        <div class="knowledge-point">
            <h3>第一类切比雪夫滤波器</h3>
            
            <h4>幅度平方响应</h4>
            <div class="formula">
                |H(jω)|² = 1/(1 + ε²Tn²(ω/ωp))
            </div>
            
            <p>其中：</p>
            <ul>
                <li><strong>ε</strong>：纹波参数，ε = √(10^(Rp/10) - 1)</li>
                <li><strong>Tn(x)</strong>：n阶切比雪夫多项式</li>
                <li><strong>ωp</strong>：通带截止频率</li>
            </ul>
            
            <h4>切比雪夫多项式</h4>
            <div class="formula">
                T0(x) = 1<br>
                T1(x) = x<br>
                T2(x) = 2x² - 1<br>
                Tn(x) = 2xTn-1(x) - Tn-2(x)
            </div>
        </div>
        
        <div class="knowledge-point">
            <h3>第二类切比雪夫滤波器</h3>
            
            <h4>幅度平方响应</h4>
            <div class="formula">
                |H(jω)|² = 1/(1 + 1/(ε²Un²(ωs/ω)))
            </div>
            
            <p>其中：</p>
            <ul>
                <li><strong>Un(x)</strong>：n阶第二类切比雪夫多项式</li>
                <li><strong>ωs</strong>：阻带截止频率</li>
                <li><strong>特点</strong>：阻带有等纹波，通带单调下降</li>
            </ul>
        </div>
        
        <div class="comparison-grid">
            <div class="comparison-item">
                <h4>巴特沃思</h4>
                <ul>
                    <li>通带最大平坦</li>
                    <li>单调特性</li>
                    <li>较宽过渡带</li>
                    <li>群延迟较平坦</li>
                    <li>设计简单</li>
                </ul>
            </div>
            <div class="comparison-item">
                <h4>切比雪夫I型</h4>
                <ul>
                    <li>通带等纹波</li>
                    <li>阻带单调</li>
                    <li>较窄过渡带</li>
                    <li>群延迟变化大</li>
                    <li>较好选择性</li>
                </ul>
            </div>
            <div class="comparison-item">
                <h4>切比雪夫II型</h4>
                <ul>
                    <li>通带单调</li>
                    <li>阻带等纹波</li>
                    <li>过渡带中等</li>
                    <li>相位特性好</li>
                    <li>设计复杂</li>
                </ul>
            </div>
        </div>
        
        <div class="plot-container">
            <h3>三种滤波器类型对比</h3>
            <canvas id="filterComparison" width="800" height="400"></canvas>
            <div class="controls">
                <label>滤波器阶数：</label>
                <input type="range" id="comparisonOrder" min="2" max="8" step="1" value="4">
                <span id="comparisonOrderValue">4</span>
                <label>通带纹波：</label>
                <input type="range" id="rippleAmount" min="0.1" max="3" step="0.1" value="1">
                <span id="rippleValue">1.0</span> dB
                <button onclick="updateFilterComparison()">更新对比</button>
            </div>
        </div>
        
        <h2>3. 频率变换</h2>
        
        <div class="knowledge-point">
            <h3>频率变换的基本思想</h3>
            <p>频率变换允许我们从<strong>低通原型滤波器</strong>出发，通过<strong>复频率变换</strong>得到其他类型的滤波器：</p>
            
            <div class="formula">
                s → f(s)
            </div>
            
            <p>其中f(s)是变换函数，将原型滤波器的复频率s映射到新滤波器的复频率。</p>
        </div>
        
        <div class="design-steps">
            <h3>🔄 四种基本频率变换</h3>
            
            <h4>1. 低通到低通变换</h4>
            <div class="formula">
                s → s/ωc'
            </div>
            <p>将截止频率从ωc变换到ωc'</p>
            
            <h4>2. 低通到高通变换</h4>
            <div class="formula">
                s → ωc·ωc'/s
            </div>
            <p>低频和高频互换，截止频率为ωc'</p>
            
            <h4>3. 低通到带通变换</h4>
            <div class="formula">
                s → (s² + ωl·ωh)/(s(ωh - ωl))
            </div>
            <p>其中ωl为下截止频率，ωh为上截止频率</p>
            
            <h4>4. 低通到带阻变换</h4>
            <div class="formula">
                s → s(ωh - ωl)/(s² + ωl·ωh)
            </div>
            <p>阻带在[ωl, ωh]之间</p>
        </div>
        
        <div class="important">
            <h3>⚠️ 频率变换的重要性质</h3>
            <ul>
                <li><strong>保持滤波器类型</strong>：巴特沃思→巴特沃思，切比雪夫→切比雪夫</li>
                <li><strong>阶数变化</strong>：低通到带通/带阻时阶数加倍</li>
                <li><strong>稳定性保持</strong>：稳定的原型产生稳定的变换滤波器</li>
                <li><strong>因果性保持</strong>：因果的原型产生因果的变换滤波器</li>
            </ul>
        </div>
        
        <div class="plot-container">
            <h3>频率变换演示</h3>
            <div class="transformation-demo">
                <div class="transformation-part">
                    <canvas id="prototypeFilter" width="250" height="200"></canvas>
                    <p>低通原型</p>
                </div>
                <div class="transformation-part">
                    <canvas id="transformedFilter" width="250" height="200"></canvas>
                    <p>变换后滤波器</p>
                </div>
            </div>
            <div class="controls">
                <label>变换类型：</label>
                <select id="transformationType">
                    <option value="lowpass">低通→低通</option>
                    <option value="highpass">低通→高通</option>
                    <option value="bandpass">低通→带通</option>
                    <option value="bandstop">低通→带阻</option>
                </select>
                <label>参数1：</label>
                <input type="range" id="transformParam1" min="0.5" max="5" step="0.1" value="2">
                <span id="param1Value">2.0</span>
                <label>参数2：</label>
                <input type="range" id="transformParam2" min="1" max="8" step="0.1" value="4">
                <span id="param2Value">4.0</span>
                <button onclick="updateTransformationDemo()">应用变换</button>
            </div>
        </div>
        
        <div class="characteristic-table">
            <h3>滤波器设计选择指南</h3>
            <table>
                <tr>
                    <th>应用要求</th>
                    <th>推荐类型</th>
                    <th>原因</th>
                </tr>
                <tr>
                    <td>最大通带平坦度</td>
                    <td>巴特沃思</td>
                    <td>通带内幅度响应最平坦</td>
                </tr>
                <tr>
                    <td>最陡峭的过渡带</td>
                    <td>切比雪夫I型</td>
                    <td>相同阶数下过渡带最窄</td>
                </tr>
                <tr>
                    <td>最佳时域响应</td>
                    <td>巴特沃思</td>
                    <td>群延迟变化最小</td>
                </tr>
                <tr>
                    <td>严格阻带要求</td>
                    <td>切比雪夫II型</td>
                    <td>阻带衰减可控</td>
                </tr>
                <tr>
                    <td>简单实现</td>
                    <td>巴特沃思</td>
                    <td>设计公式最简单</td>
                </tr>
            </table>
        </div>
        
        <div class="plot-container">
            <h3>滤波器设计计算器</h3>
            <canvas id="designCalculator" width="800" height="300"></canvas>
            <div class="controls">
                <label>滤波器类型：</label>
                <select id="calculatorType">
                    <option value="butterworth">巴特沃思</option>
                    <option value="chebyshev1">切比雪夫I型</option>
                    <option value="chebyshev2">切比雪夫II型</option>
                </select>
                <label>通带频率(Hz)：</label>
                <input type="number" id="passbandFreq" value="1000" min="100" max="10000">
                <label>阻带频率(Hz)：</label>
                <input type="number" id="stopbandFreq" value="2000" min="200" max="20000">
                <label>通带纹波(dB)：</label>
                <input type="number" id="passbandRipple" value="1" min="0.1" max="5" step="0.1">
                <label>阻带衰减(dB)：</label>
                <input type="number" id="stopbandAtten" value="40" min="20" max="100">
                <button onclick="calculateFilter()">计算滤波器</button>
            </div>
            <div id="calculatorResult" style="margin-top: 15px; padding: 10px; background: #f8f9fa; border-radius: 5px;"></div>
        </div>
        
        <h2>练习题目</h2>
        
        <div class="exercise">
            <h4>练习1：巴特沃思滤波器设计</h4>
            <p>设计一个巴特沃思低通滤波器，要求：</p>
            <ul>
                <li>通带截止频率：fp = 1kHz</li>
                <li>阻带截止频率：fs = 3kHz</li>
                <li>通带最大衰减：Ap = 3dB</li>
                <li>阻带最小衰减：As = 20dB</li>
            </ul>
            <p>求所需的滤波器阶数和3dB截止频率。</p>
            <button class="show-answer" onclick="toggleAnswer('answer1')">显示答案</button>
            <div id="answer1" class="answer">
                <strong>答案：</strong><br>
                1. 计算阶数：n ≥ log((10^2 - 1)/(10^0.3 - 1)) / (2log(3)) = log(99/0.995) / (2log(3)) ≈ 2.04<br>
                取n = 3<br>
                2. 选择3dB截止频率：<br>
                   - 按通带要求：ωc ≥ ωp = 2π×1000 = 6283 rad/s<br>
                   - 按阻带要求：ωc ≤ ωs/(10^(As/10)-1)^(1/2n) = 18849/2.68 ≈ 7033 rad/s<br>
                   - 选择ωc = 6283 rad/s (fc = 1kHz)
            </div>
        </div>
        
        <div class="exercise">
            <h4>练习2：切比雪夫滤波器特性</h4>
            <p>对于4阶切比雪夫I型滤波器，通带纹波为1dB：</p>
            <ol>
                <li>计算纹波参数ε</li>
                <li>在通带边界频率处的幅度响应是多少？</li>
                <li>与同阶巴特沃思滤波器相比有什么优缺点？</li>
            </ol>
            <button class="show-answer" onclick="toggleAnswer('answer2')">显示答案</button>
            <div id="answer2" class="answer">
                <strong>答案：</strong><br>
                1. ε = √(10^(1/10) - 1) = √(1.259 - 1) = 0.509<br>
                2. 在通带边界：|H(jωp)| = 1/√(1 + ε²) = 1/√(1 + 0.259) = 0.891 (-1dB)<br>
                3. 优点：过渡带更陡峭，频率选择性更好<br>
                   缺点：通带有纹波，群延迟变化较大，相位特性较差
            </div>
        </div>
        
        <div class="exercise">
            <h4>练习3：频率变换</h4>
            <p>从巴特沃思低通原型 H(s) = 1/(s² + √2s + 1) 出发：</p>
            <ol>
                <li>设计截止频率为2kHz的低通滤波器</li>
                <li>设计截止频率为500Hz的高通滤波器</li>
                <li>设计中心频率1kHz、带宽500Hz的带通滤波器</li>
            </ol>
            <button class="show-answer" onclick="toggleAnswer('answer3')">显示答案</button>
            <div id="answer3" class="answer">
                <strong>答案：</strong><br>
                1. 低通变换 s → s/ωc'，ωc' = 2π×2000<br>
                   H₁(s) = (2π×2000)²/((s + √2×2π×2000s + (2π×2000)²)<br>
                2. 高通变换 s → ωc×ωc'/s，ωc' = 2π×500<br>
                   H₂(s) = s²/(s² + √2×2π×500s + (2π×500)²)<br>
                3. 带通变换，ωl = 2π×750, ωh = 2π×1250<br>
                   变换后得到4阶带通滤波器
            </div>
        </div>
        
        <div class="exercise">
            <h4>练习4：滤波器选择</h4>
            <p>某音频处理系统需要滤除3kHz以上的高频噪声，要求：</p>
            <ul>
                <li>3kHz处衰减不超过1dB</li>
                <li>10kHz处至少衰减40dB</li>
                <li>相位失真要尽量小</li>
            </ul>
            <p>应该选择哪种类型的滤波器？为什么？</p>
            <button class="show-answer" onclick="toggleAnswer('answer4')">显示答案</button>
            <div id="answer4" class="answer">
                <strong>答案：</strong><br>
                推荐选择巴特沃思滤波器，理由：<br>
                1. 过渡带较宽(3kHz到10kHz)，不需要特别陡峭的特性<br>
                2. 要求相位失真小，巴特沃思滤波器群延迟变化最小<br>
                3. 音频应用对通带平坦度要求高，巴特沃思最适合<br>
                4. 计算所需阶数约为4-5阶，实现相对简单<br>
                5. 切比雪夫滤波器虽然过渡带更陡，但会引入相位失真，不适合音频应用
            </div>
        </div>
        
        <h2>学习要点总结</h2>
        
        <div class="important">
            <h3>🎯 核心掌握要点</h3>
            <ol>
                <li><strong>巴特沃思滤波器</strong>：最大平坦特性，设计简单，适合要求相位特性好的应用</li>
                <li><strong>切比雪夫滤波器</strong>：等纹波特性，过渡带陡峭，适合要求频率选择性高的应用</li>
                <li><strong>滤波器选择</strong>：根据应用要求选择合适的逼近方法</li>
                <li><strong>频率变换</strong>：从低通原型设计其他类型滤波器的系统化方法</li>
                <li><strong>设计流程</strong>：指标分析→阶数计算→参数确定→传递函数构造</li>
                <li><strong>工程权衡</strong>：平坦度vs选择性，简单性vs性能的平衡</li>
            </ol>
        </div>
        
        <div class="filter-property">
            <h3>🔗 设计方法的发展</h3>
            <p><strong>经典模拟滤波器设计</strong>为现代滤波器设计奠定了基础：</p>
            <ul>
                <li>这些设计方法后来被用于数字滤波器设计（双线性变换等）</li>
                <li>频率变换的思想在数字滤波器设计中同样适用</li>
                <li>现代CAD工具大多基于这些经典理论</li>
                <li>为理解高级滤波器（椭圆、贝塞尔等）提供基础</li>
            </ul>
        </div>
    </div>

    <script>
        // 巴特沃思滤波器响应计算
        function butterworthResponse(omega, omegaC, n) {
            const ratio = omega / omegaC;
            return 1 / Math.sqrt(1 + Math.pow(ratio, 2 * n));
        }
        
        // 切比雪夫I型响应计算
        function chebyshev1Response(omega, omegaP, n, epsilon) {
            const x = omega / omegaP;
            const Tn = chebyshevPolynomial(n, x);
            return 1 / Math.sqrt(1 + epsilon * epsilon * Tn * Tn);
        }
        
        // 切比雪夫多项式计算
        function chebyshevPolynomial(n, x) {
            if (n === 0) return 1;
            if (n === 1) return x;
            
            let T0 = 1;
            let T1 = x;
            let Tn = 0;
            
            for (let i = 2; i <= n; i++) {
                Tn = 2 * x * T1 - T0;
                T0 = T1;
                T1 = Tn;
            }
            
            return Tn;
        }
        
        // 更新巴特沃思演示
        function updateButterworthDemo() {
            const canvas = document.getElementById('butterworthDemo');
            const ctx = canvas.getContext('2d');
            const width = canvas.width;
            const height = canvas.height;
            const order = parseInt(document.getElementById('butterworthOrder').value);
            const cutoff = parseFloat(document.getElementById('butterworthCutoff').value);
            
            document.getElementById('butterworthOrderValue').textContent = order;
            document.getElementById('butterworthCutoffValue').textContent = cutoff.toFixed(1);
            
            ctx.clearRect(0, 0, width, height);
            
            // 绘制频率响应和相位响应
            drawButterworthResponse(ctx, width, height/2, order, cutoff, 'magnitude');
            drawButterworthResponse(ctx, width, height/2, order, cutoff, 'phase', height/2);
            
            // 更新极点图
            drawButterworthPoles(order);
        }
        
        function drawButterworthResponse(ctx, width, height, order, cutoff, type, offsetY = 0) {
            const centerY = offsetY + height * 0.8;
            const freqRange = 10;
            const scaleX = (width - 60) / freqRange;
            const scaleY = height * 0.5;
            
            // 坐标轴
            ctx.strokeStyle = '#333';
            ctx.lineWidth = 1;
            
            ctx.beginPath();
            ctx.moveTo(30, centerY);
            ctx.lineTo(width - 30, centerY);
            ctx.stroke();
            
            ctx.beginPath();
            ctx.moveTo(30, offsetY + 20);
            ctx.lineTo(30, centerY);
            ctx.stroke();
            
            // 绘制响应曲线
            ctx.strokeStyle = '#e74c3c';
            ctx.lineWidth = 3;
            ctx.beginPath();
            
            for (let i = 0; i <= 200; i++) {
                const freq = (i / 200) * freqRange;
                const x = 30 + freq * scaleX;
                let y;
                
                if (type === 'magnitude') {
                    const magnitude = butterworthResponse(freq, cutoff, order);
                    y = centerY - magnitude * scaleY;
                } else {
                    // 简化的相位响应
                    const phase = -order * Math.atan(freq / cutoff);
                    y = centerY - (phase / Math.PI) * scaleY;
                }
                
                if (i === 0) {
                    ctx.moveTo(x, y);
                } else {
                    ctx.lineTo(x, y);
                }
            }
            ctx.stroke();
            
            // 3dB线（仅在幅度图上）
            if (type === 'magnitude') {
                ctx.strokeStyle = '#666';
                ctx.setLineDash([5, 5]);
                const y3dB = centerY - (1/Math.sqrt(2)) * scaleY;
                ctx.beginPath();
                ctx.moveTo(30, y3dB);
                ctx.lineTo(width - 30, y3dB);
                ctx.stroke();
                ctx.setLineDash([]);
                
                // 截止频率线
                const xCutoff = 30 + cutoff * scaleX;
                ctx.beginPath();
                ctx.moveTo(xCutoff, offsetY + 20);
                ctx.lineTo(xCutoff, centerY);
                ctx.stroke();
            }
            
            // 标题
            ctx.fillStyle = '#333';
            ctx.font = '14px Arial';
            ctx.textAlign = 'center';
            const title = type === 'magnitude' ? `${order}阶巴特沃思滤波器幅度响应` : `${order}阶巴特沃思滤波器相位响应`;
            ctx.fillText(title, width / 2, offsetY + 15);
        }
        
        // 绘制巴特沃思极点
        function drawButterworthPoles(order) {
            const canvas = document.getElementById('butterworthPoles');
            const ctx = canvas.getContext('2d');
            const width = canvas.width;
            const height = canvas.height;
            
            ctx.clearRect(0, 0, width, height);
            
            const centerX = width / 2;
            const centerY = height / 2;
            const radius = Math.min(width, height) / 3;
            
            // 坐标轴
            ctx.strokeStyle = '#333';
            ctx.lineWidth = 1;
            
            ctx.beginPath();
            ctx.moveTo(20, centerY);
            ctx.lineTo(width - 20, centerY);
            ctx.stroke();
            
            ctx.beginPath();
            ctx.moveTo(centerX, 20);
            ctx.lineTo(centerX, height - 20);
            ctx.stroke();
            
            // 单位圆
            ctx.strokeStyle = '#666';
            ctx.setLineDash([5, 5]);
            ctx.beginPath();
            ctx.arc(centerX, centerY, radius, 0, 2 * Math.PI);
            ctx.stroke();
            ctx.setLineDash([]);
            
            // 极点
            ctx.fillStyle = '#e74c3c';
            for (let k = 0; k < order; k++) {
                const angle = (2 * k + order - 1) * Math.PI / (2 * order);
                const x = centerX + radius * Math.cos(angle + Math.PI);
                const y = centerY + radius * Math.sin(angle + Math.PI);
                
                ctx.beginPath();
                ctx.arc(x, y, 5, 0, 2 * Math.PI);
                ctx.fill();
                
                // 画X表示极点
                ctx.strokeStyle = '#e74c3c';
                ctx.lineWidth = 2;
                ctx.beginPath();
                ctx.moveTo(x - 4, y - 4);
                ctx.lineTo(x + 4, y + 4);
                ctx.moveTo(x - 4, y + 4);
                ctx.lineTo(x + 4, y - 4);
                ctx.stroke();
            }
            
            // 标签
            ctx.fillStyle = '#333';
            ctx.font = '12px Arial';
            ctx.textAlign = 'center';
            ctx.fillText('s平面极点分布', centerX, height - 10);
            ctx.fillText('Re', width - 10, centerY + 15);
            ctx.fillText('Im', centerX - 15, 15);
        }
        
        // 更新滤波器对比
        function updateFilterComparison() {
            const canvas = document.getElementById('filterComparison');
            const ctx = canvas.getContext('2d');
            const width = canvas.width;
            const height = canvas.height;
            const order = parseInt(document.getElementById('comparisonOrder').value);
            const ripple = parseFloat(document.getElementById('rippleAmount').value);
            
            document.getElementById('comparisonOrderValue').textContent = order;
            document.getElementById('rippleValue').textContent = ripple.toFixed(1);
            
            ctx.clearRect(0, 0, width, height);
            
            drawFilterComparison(ctx, width, height, order, ripple);
        }
        
        function drawFilterComparison(ctx, width, height, order, ripple) {
            const centerY = height * 0.8;
            const freqRange = 5;
            const scaleX = (width - 60) / freqRange;
            const scaleY = height * 0.5;
            const cutoff = 1;
            
            // 坐标轴
            ctx.strokeStyle = '#333';
            ctx.lineWidth = 1;
            
            ctx.beginPath();
            ctx.moveTo(30, centerY);
            ctx.lineTo(width - 30, centerY);
            ctx.stroke();
            
            ctx.beginPath();
            ctx.moveTo(30, 30);
            ctx.lineTo(30, centerY);
            ctx.stroke();
            
            // 绘制三种滤波器响应
            const colors = ['#e74c3c', '#3498db', '#f39c12'];
            const labels = ['巴特沃思', '切比雪夫I', '切比雪夫II'];
            const epsilon = Math.sqrt(Math.pow(10, ripple/10) - 1);
            
            for (let filterType = 0; filterType < 3; filterType++) {
                ctx.strokeStyle = colors[filterType];
                ctx.lineWidth = 3;
                ctx.beginPath();
                
                for (let i = 0; i <= 200; i++) {
                    const freq = (i / 200) * freqRange;
                    const x = 30 + freq * scaleX;
                    let magnitude;
                    
                    switch (filterType) {
                        case 0: // 巴特沃思
                            magnitude = butterworthResponse(freq, cutoff, order);
                            break;
                        case 1: // 切比雪夫I
                            magnitude = chebyshev1Response(freq, cutoff, order, epsilon);
                            break;
                        case 2: // 切比雪夫II（简化）
                            magnitude = freq <= cutoff ? 1 - 0.1 * Math.sin(order * Math.PI * freq / cutoff) : 
                                       butterworthResponse(freq, cutoff, order) * 0.8;
                            break;
                    }
                    
                    const y = centerY - magnitude * scaleY;
                    
                    if (i === 0) {
                        ctx.moveTo(x, y);
                    } else {
                        ctx.lineTo(x, y);
                    }
                }
                ctx.stroke();
            }
            
            // 图例
            for (let i = 0; i < 3; i++) {
                ctx.fillStyle = colors[i];
                ctx.fillRect(width - 150, 50 + i * 20, 20, 3);
                ctx.fillStyle = '#333';
                ctx.font = '12px Arial';
                ctx.textAlign = 'left';
                ctx.fillText(labels[i], width - 125, 55 + i * 20);
            }
            
            // 标题
            ctx.textAlign = 'center';
            ctx.fillText(`${order}阶滤波器响应对比`, width / 2, 20);
        }
        
        // 更新频率变换演示
        function updateTransformationDemo() {
            const transformType = document.getElementById('transformationType').value;
            const param1 = parseFloat(document.getElementById('transformParam1').value);
            const param2 = parseFloat(document.getElementById('transformParam2').value);
            
            document.getElementById('param1Value').textContent = param1.toFixed(1);
            document.getElementById('param2Value').textContent = param2.toFixed(1);
            
            // 绘制原型和变换后的滤波器
            drawPrototypeFilter();
            drawTransformedFilter(transformType, param1, param2);
        }
        
        function drawPrototypeFilter() {
            const canvas = document.getElementById('prototypeFilter');
            const ctx = canvas.getContext('2d');
            const width = canvas.width;
            const height = canvas.height;
            
            ctx.clearRect(0, 0, width, height);
            
            const centerY = height * 0.8;
            const freqRange = 5;
            const scaleX = (width - 40) / freqRange;
            const scaleY = height * 0.5;
            
            // 坐标轴
            ctx.strokeStyle = '#333';
            ctx.lineWidth = 1;
            
            ctx.beginPath();
            ctx.moveTo(20, centerY);
            ctx.lineTo(width - 20, centerY);
            ctx.stroke();
            
            ctx.beginPath();
            ctx.moveTo(20, 20);
            ctx.lineTo(20, centerY);
            ctx.stroke();
            
            // 绘制低通原型（巴特沃思，归一化截止频率为1）
            ctx.strokeStyle = '#3498db';
            ctx.lineWidth = 3;
            ctx.beginPath();
            
            for (let i = 0; i <= 100; i++) {
                const freq = (i / 100) * freqRange;
                const x = 20 + freq * scaleX;
                const magnitude = butterworthResponse(freq, 1, 3);
                const y = centerY - magnitude * scaleY;
                
                if (i === 0) {
                    ctx.moveTo(x, y);
                } else {
                    ctx.lineTo(x, y);
                }
            }
            ctx.stroke();
            
            // 标题
            ctx.fillStyle = '#333';
            ctx.font = '12px Arial';
            ctx.textAlign = 'center';
            ctx.fillText('3阶巴特沃思低通原型', width / 2, 15);
        }
        
        function drawTransformedFilter(transformType, param1, param2) {
            const canvas = document.getElementById('transformedFilter');
            const ctx = canvas.getContext('2d');
            const width = canvas.width;
            const height = canvas.height;
            
            ctx.clearRect(0, 0, width, height);
            
            const centerY = height * 0.8;
            const freqRange = 10;
            const scaleX = (width - 40) / freqRange;
            const scaleY = height * 0.5;
            
            // 坐标轴
            ctx.strokeStyle = '#333';
            ctx.lineWidth = 1;
            
            ctx.beginPath();
            ctx.moveTo(20, centerY);
            ctx.lineTo(width - 20, centerY);
            ctx.stroke();
            
            ctx.beginPath();
            ctx.moveTo(20, 20);
            ctx.lineTo(20, centerY);
            ctx.stroke();
            
            // 绘制变换后的滤波器
            ctx.strokeStyle = '#e74c3c';
            ctx.lineWidth = 3;
            ctx.beginPath();
            
            for (let i = 0; i <= 200; i++) {
                const freq = (i / 200) * freqRange;
                const x = 20 + freq * scaleX;
                let magnitude = 0;
                
                switch (transformType) {
                    case 'lowpass':
                        magnitude = butterworthResponse(freq, param1, 3);
                        break;
                    case 'highpass':
                        magnitude = freq > 0 ? butterworthResponse(param1 / freq, 1, 3) : 0;
                        break;
                    case 'bandpass':
                        const center = Math.sqrt(param1 * param2);
                        const bw = param2 - param1;
                        const transformed = freq > 0 ? (freq * freq - center * center) / (freq * bw) : 0;
                        magnitude = butterworthResponse(Math.abs(transformed), 1, 3);
                        break;
                    case 'bandstop':
                        const center2 = Math.sqrt(param1 * param2);
                        const bw2 = param2 - param1;
                        const transformed2 = freq > 0 ? (freq * bw2) / (freq * freq - center2 * center2) : 0;
                        magnitude = Math.abs(transformed2) > 100 ? 0 : butterworthResponse(Math.abs(transformed2), 1, 3);
                        break;
                }
                
                const y = centerY - Math.min(magnitude, 1) * scaleY;
                
                if (i === 0) {
                    ctx.moveTo(x, y);
                } else {
                    ctx.lineTo(x, y);
                }
            }
            ctx.stroke();
            
            // 标题
            ctx.fillStyle = '#333';
            ctx.font = '12px Arial';
            ctx.textAlign = 'center';
            const titles = {
                'lowpass': `低通 (fc=${param1.toFixed(1)}Hz)`,
                'highpass': `高通 (fc=${param1.toFixed(1)}Hz)`,
                'bandpass': `带通 (${param1.toFixed(1)}-${param2.toFixed(1)}Hz)`,
                'bandstop': `带阻 (${param1.toFixed(1)}-${param2.toFixed(1)}Hz)`
            };
            ctx.fillText(titles[transformType], width / 2, 15);
        }
        
        // 滤波器设计计算器
        function calculateFilter() {
            const type = document.getElementById('calculatorType').value;
            const fp = parseFloat(document.getElementById('passbandFreq').value);
            const fs = parseFloat(document.getElementById('stopbandFreq').value);
            const Rp = parseFloat(document.getElementById('passbandRipple').value);
            const As = parseFloat(document.getElementById('stopbandAtten').value);
            
            // 计算所需阶数
            let order = 0;
            let cutoffFreq = 0;
            
            const omegaP = 2 * Math.PI * fp;
            const omegaS = 2 * Math.PI * fs;
            const ratio = omegaS / omegaP;
            
            switch (type) {
                case 'butterworth':
                    const numer = Math.log10((Math.pow(10, As/10) - 1) / (Math.pow(10, Rp/10) - 1));
                    const denom = 2 * Math.log10(ratio);
                    order = Math.ceil(numer / denom);
                    cutoffFreq = fp; // 选择通带边界作为3dB点
                    break;
                    
                case 'chebyshev1':
                    const epsilon = Math.sqrt(Math.pow(10, Rp/10) - 1);
                    const numer1 = Math.acosh(Math.sqrt((Math.pow(10, As/10) - 1) / (epsilon * epsilon)));
                    const denom1 = Math.acosh(ratio);
                    order = Math.ceil(numer1 / denom1);
                    cutoffFreq = fp;
                    break;
                    
                case 'chebyshev2':
                    const epsilon2 = 1 / Math.sqrt(Math.pow(10, As/10) - 1);
                    order = Math.ceil(Math.acosh(1/epsilon2) / Math.acosh(ratio));
                    cutoffFreq = fs;
                    break;
            }
            
            // 显示计算结果
            const resultDiv = document.getElementById('calculatorResult');
            resultDiv.innerHTML = `
                <h4>设计结果</h4>
                <p><strong>滤波器类型：</strong>${getFilterTypeName(type)}</p>
                <p><strong>所需阶数：</strong>${order}</p>
                <p><strong>截止频率：</strong>${cutoffFreq.toFixed(0)} Hz</p>
                <p><strong>频率比：</strong>${ratio.toFixed(2)}</p>
                <p><strong>设计评估：</strong>${getDesignAssessment(order, ratio)}</p>
            `;
            
            // 绘制设计结果
            drawDesignResult(type, order, cutoffFreq, fp, fs);
        }
        
        function getFilterTypeName(type) {
            const names = {
                'butterworth': '巴特沃思滤波器',
                'chebyshev1': '切比雪夫I型滤波器', 
                'chebyshev2': '切比雪夫II型滤波器'
            };
            return names[type];
        }
        
        function getDesignAssessment(order, ratio) {
            if (order <= 2) return '低阶设计，实现简单';
            if (order <= 4) return '中等阶数，性能与复杂度平衡';
            if (order <= 6) return '较高阶数，性能好但复杂度高';
            return '高阶设计，需要考虑稳定性和敏感度';
        }
        
        function drawDesignResult(type, order, cutoffFreq, fp, fs) {
            const canvas = document.getElementById('designCalculator');
            const ctx = canvas.getContext('2d');
            const width = canvas.width;
            const height = canvas.height;
            
            ctx.clearRect(0, 0, width, height);
            
            const centerY = height * 0.8;
            const freqRange = Math.max(fs * 2, 10000);
            const scaleX = (width - 60) / freqRange;
            const scaleY = height * 0.5;
            
            // 坐标轴
            ctx.strokeStyle = '#333';
            ctx.lineWidth = 1;
            
            ctx.beginPath();
            ctx.moveTo(30, centerY);
            ctx.lineTo(width - 30, centerY);
            ctx.stroke();
            
            ctx.beginPath();
            ctx.moveTo(30, 30);
            ctx.lineTo(30, centerY);
            ctx.stroke();
            
            // 绘制设计的滤波器响应
            ctx.strokeStyle = '#e74c3c';
            ctx.lineWidth = 3;
            ctx.beginPath();
            
            for (let i = 0; i <= 200; i++) {
                const freq = (i / 200) * freqRange;
                const x = 30 + freq * scaleX;
                let magnitude;
                
                switch (type) {
                    case 'butterworth':
                        magnitude = butterworthResponse(freq, cutoffFreq, order);
                        break;
                    case 'chebyshev1':
                        const epsilon = Math.sqrt(Math.pow(10, 1/10) - 1); // 简化为1dB纹波
                        magnitude = chebyshev1Response(freq, cutoffFreq, order, epsilon);
                        break;
                    case 'chebyshev2':
                        magnitude = butterworthResponse(freq, cutoffFreq, order) * 0.9; // 简化表示
                        break;
                }
                
                const y = centerY - magnitude * scaleY;
                
                if (i === 0) {
                    ctx.moveTo(x, y);
                } else {
                    ctx.lineTo(x, y);
                }
            }
            ctx.stroke();
            
            // 标记关键频率
            ctx.strokeStyle = '#666';
            ctx.setLineDash([5, 5]);
            
            // 通带频率
            const xp = 30 + fp * scaleX;
            ctx.beginPath();
            ctx.moveTo(xp, 30);
            ctx.lineTo(xp, centerY);
            ctx.stroke();
            
            // 阻带频率
            const xs = 30 + fs * scaleX;
            ctx.beginPath();
            ctx.moveTo(xs, 30);
            ctx.lineTo(xs, centerY);
            ctx.stroke();
            
            ctx.setLineDash([]);
            
            // 标签
            ctx.fillStyle = '#333';
            ctx.font = '12px Arial';
            ctx.textAlign = 'center';
            ctx.fillText(`${order}阶${getFilterTypeName(type)}设计结果`, width / 2, 20);
            ctx.fillText(`fp=${fp}Hz`, xp, centerY + 20);
            ctx.fillText(`fs=${fs}Hz`, xs, centerY + 20);
        }
        
        // 切换答案显示
        function toggleAnswer(answerId) {
            const answer = document.getElementById(answerId);
            answer.style.display = answer.style.display === 'none' ? 'block' : 'none';
        }
        
        // 页面加载后初始化
        window.onload = function() {
            updateButterworthDemo();
            updateFilterComparison();
            updateTransformationDemo();
            calculateFilter();
        };
    </script>
</body>
</html>